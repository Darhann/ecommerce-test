<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Добавить товар</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div th:replace="~{fragments :: header}"></div>

<main class="container mt-5" style="max-width: 700px;">
    <div class="card">
        <div class="card-body">
            <h1 class="card-title text-center mb-4">Добавление нового товара</h1>
            <form id="add-product-form">
                <div class="mb-3">
                    <label for="name" class="form-label">Название</label>
                    <input type="text" class="form-control" id="name" required>
                </div>
                <div class="mb-3">
                    <label for="description" class="form-label">Описание</label>
                    <textarea class="form-control" id="description" rows="3"></textarea>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="price" class="form-label">Цена</label>
                        <input type="number" step="0.01" class="form-control" id="price" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="stock" class="form-label">Количество на складе</label>
                        <input type="number" class="form-control" id="stock" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="imageUrl" class="form-label">URL изображения</label>
                    <input type="text" class="form-control" id="imageUrl" placeholder="/images/my-image.png">
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary">Создать товар</button>
                </div>
                <div id="message" class="mt-3"></div>
            </form>
        </div>
    </div>
</main>

<script>
    document.getElementById('add-product-form').addEventListener('submit', function(event) {
        event.preventDefault();
        const token = localStorage.getItem('jwt_token');
        const messageDiv = document.getElementById('message');

        if (!token) {
            window.location.href = '/login';
            return;
        }

        const product = {
            name: document.getElementById('name').value,
            description: document.getElementById('description').value,
            price: parseFloat(document.getElementById('price').value),
            stock: parseInt(document.getElementById('stock').value),
            imageUrl: document.getElementById('imageUrl').value
        };

        fetch('/api/products', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify(product)
        })
            .then(async response => {
                if (response.ok) {
                    messageDiv.className = 'text-success';
                    messageDiv.textContent = 'Товар успешно создан!';
                    document.getElementById('add-product-form').reset(); // Очищаем форму
                } else {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Ошибка при создании товара.');
                }
            })
            .catch(error => {
                messageDiv.className = 'text-danger';
                messageDiv.textContent = 'Ошибка: ' + error.message;
            });
    });
</script>
<script th:src="@{/js/main.js}"></script>
</body>
</html>